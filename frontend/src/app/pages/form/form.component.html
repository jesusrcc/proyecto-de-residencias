<div class="form-container">
  <h1>Formulario de investigador</h1>

  <form #investigadorForm="ngForm" (ngSubmit)="save()" class="form">
    <!-- ================= DATOS PERSONALES ================= -->
    <fieldset>
      <legend>Datos personales</legend>

      <div class="profile-header">
        <div class="photo-section">
          <div class="photo-upload" (click)="triggerFileInput()">
            <img
              *ngIf="user.photoUrl"
              [src]="user.photoUrl"
              alt="Foto del investigador"
              class="photo-preview"
            />
            <div *ngIf="!user.photoUrl" class="photo-placeholder"></div>
            <input
              type="file"
              #fileInput
              accept="image/png, image/jpeg"
              (change)="onFileSelected($event)"
              hidden
            />
          </div>
          <small class="photo-hint">Haz clic para subir o cambiar la foto</small>
        </div>

        <!-- Ь Campos personales -->
        <div class="personal-info">
          <div class="row">
            <div class="field">
              <label>Nombre <span class="required">*</span></label>
              <input
                [(ngModel)]="user.name"
                name="name"
                type="text"
                required
                #name="ngModel"
              />
              <small class="error" *ngIf="name.invalid && name.touched">
                Este campo es obligatorio.
              </small>
            </div>

            <div class="field">
              <label>Primer apellido <span class="required">*</span></label>
              <input
                [(ngModel)]="user.firstName"
                name="firstName"
                type="text"
                required
                #firstName="ngModel"
              />
              <small class="error" *ngIf="firstName.invalid && firstName.touched">
                Este campo es obligatorio.
              </small>
            </div>

            <div class="field">
              <label>Segundo apellido <span class="required">*</span></label>
              <input
                [(ngModel)]="user.lastName"
                name="lastName"
                type="text"
                required
                #lastName="ngModel"
              />
              <small class="error" *ngIf="lastName.invalid && lastName.touched">
                Este campo es obligatorio.
              </small>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>Correo electr贸nico <span class="required">*</span></label>
              <input
                [(ngModel)]="user.email"
                name="email"
                type="email"
                required
                #email="ngModel"
              />
              <small class="error" *ngIf="email.invalid && email.touched">
                Ingresa un correo v谩lido.
              </small>
            </div>

            <div class="field">
              <label>Pa铆s <span class="required">*</span></label>
              <input
                [(ngModel)]="user.country"
                name="country"
                type="text"
                required
                #country="ngModel"
              />
              <small class="error" *ngIf="country.invalid && country.touched">
                Este campo es obligatorio.
              </small>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>ORCID</label>
              <input
                [(ngModel)]="user.orcid"
                name="orcid"
                placeholder="0000-0000-0000-0000"
              />
            </div>
            <div class="field">
              <label>Google Scholar</label>
              <input
                [(ngModel)]="user.googleScholar"
                name="googleScholar"
                placeholder="https://scholar.google.com/..."
              />
            </div>
          </div>

          <div class="field">
            <label>Biograf铆a / Resumen</label>
            <textarea
              [(ngModel)]="user.bio"
              name="bio"
              rows="3"
              placeholder="Escribe una breve descripci贸n..."
            ></textarea>
          </div>
        </div>
      </div>
    </fieldset>

    <!-- ================= PUBLICACIONES ================= -->
    <fieldset>
      <legend>Publicaciones</legend>

      <div *ngFor="let pub of user.publications; let i = index" class="item-row">
        <input
          [(ngModel)]="pub.title"
          name="pubTitle{{ i }}"
          placeholder="T铆tulo de la publicaci贸n"
        />
        <input
          [(ngModel)]="pub.journal"
          name="pubJournal{{ i }}"
          placeholder="Revista"
        />
        <input
          type="date"
          [(ngModel)]="pub.date"
          name="pubDate{{ i }}"
          (keydown)="$event.preventDefault()"
          (paste)="$event.preventDefault()"
          (drop)="$event.preventDefault()"
          min="1950-01-01"
          [max]="today"
        />
        <button type="button" class="remove-btn" (click)="removeItem('publications', i)">
          Eliminar
        </button>
      </div>

      <button type="button" class="add-btn" (click)="addItem('publications')">Agregar</button>
    </fieldset>

    <!-- ================= CURSOS ================= -->
    <fieldset>
      <legend>Cursos y formaci贸n</legend>

      <div *ngFor="let course of user.courses; let i = index" class="item-row">
        <input
          [(ngModel)]="course.title"
          name="courseTitle{{ i }}"
          placeholder="Nombre del curso o formaci贸n"
        />
        <input
          [(ngModel)]="course.institution"
          name="courseInstitution{{ i }}"
          placeholder="Instituci贸n"
        />
        <input
          type="date"
          [(ngModel)]="course.date"
          name="courseDate{{ i }}"
          (keydown)="$event.preventDefault()"
          (paste)="$event.preventDefault()"
          (drop)="$event.preventDefault()"
          min="1950-01-01"
          [max]="today"
        />
        <button type="button" class="remove-btn" (click)="removeItem('courses', i)">
          Eliminar
        </button>
      </div>

      <button type="button" class="add-btn" (click)="addItem('courses')">Agregar</button>
    </fieldset>

    <!-- ================= HITOS ================= -->
    <fieldset>
      <legend>Hitos / Trayectoria</legend>

      <div *ngFor="let milestone of user.milestones; let i = index" class="item-row">
        <input
          [(ngModel)]="milestone.title"
          name="mileTitle{{ i }}"
          placeholder="T铆tulo del hito"
        />
        <input
          type="date"
          [(ngModel)]="milestone.date"
          name="mileDate{{ i }}"
          (keydown)="$event.preventDefault()"
          (paste)="$event.preventDefault()"
          (drop)="$event.preventDefault()"
          min="1950-01-01"
          [max]="today"
        />
        <select [(ngModel)]="milestone.type" name="mileType{{ i }}">
          <option value="Puesto">Puesto</option>
          <option value="Publicaci贸n">Publicaci贸n</option>
          <option value="Curso">Curso</option>
          <option value="Otro">Otro</option>
        </select>
        <input
          [(ngModel)]="milestone.description"
          name="mileDescription{{ i }}"
          placeholder="Descripci贸n breve"
        />
        <button type="button" class="remove-btn" (click)="removeItem('milestones', i)">
          Eliminar
        </button>
      </div>

      <button type="button" class="add-btn" (click)="addItem('milestones')">Agregar</button>
    </fieldset>

    <button type="submit" [disabled]="investigadorForm.invalid || loading">
      {{ loading ? 'Guardando...' : 'Guardar cambios' }}
    </button>

    <p class="success" *ngIf="message">{{ message }}</p>
  </form>
</div>
