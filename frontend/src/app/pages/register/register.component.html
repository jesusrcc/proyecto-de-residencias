<section class="login">
  <div class="login-card">
    <h1>Crear cuenta</h1>

    <!-- Formulario con detección reactiva -->
    <form #form="ngForm" (ngSubmit)="submit()" class="form">
      <label>Nombres <span class="required">*</span></label>
      <input [(ngModel)]="user.name" name="name" type="text" required />

      <label>Primer apellido <span class="required">*</span></label>
      <input [(ngModel)]="user.firstName" name="firstName" type="text" required />

      <label>Segundo apellido <span class="required">*</span></label>
      <input [(ngModel)]="user.lastName" name="lastName" type="text" required />

      <label>Correo electrónico <span class="required">*</span></label>
      <input
        [(ngModel)]="user.email"
        name="email"
        type="email"
        required
        placeholder="correo@dominio.com"
      />
      <p *ngIf="user.email && !isEmailValid()" class="error">
        El correo no es válido
     </p>


      <label>País <span class="required">*</span></label>
      <input
        [(ngModel)]="user.country"
        name="country"
        type="text"
        required
        placeholder="México"
      />

      <label>Contraseña <span class="required">*</span></label>
      <input
        [(ngModel)]="user.password"
        name="password"
        type="password"
        required
        placeholder="••••••••"
      />

      <!-- ✅ Validación visual dinámica -->
      <div class="password-hint" *ngIf="user.password">
        <p [class.valid]="hasMinLength" [class.invalid]="!hasMinLength">
            • Mínimo 8 caracteres
        </p>
        <p [class.valid]="hasUppercase" [class.invalid]="!hasUppercase">
            • Al menos una mayúscula
        </p>
        <p [class.valid]="hasNumber" [class.invalid]="!hasNumber">
            • Al menos un número
        </p>
      </div>


      <label>Confirmar contraseña <span class="required">*</span></label>
      <input
        [(ngModel)]="password2"
        name="password2"
        type="password"
        required
        placeholder="••••••••"
      />

      <!-- ⚠️ Mensaje visible en tiempo real -->
      <p *ngIf="password2 && !passwordsMatch()" class="error">
        Las contraseñas no coinciden.
      </p>

      <button
        type="submit"
        [disabled]="!form.valid || !passwordsMatch() || loading"
        [class.active]="form.valid && passwordsMatch() && !loading"
      >
        {{ loading ? 'Registrando…' : 'Registrar' }}
      </button>

      <p class="error" *ngIf="message">{{ message }}</p>
    </form>

    <p class="help">
      ¿Ya tienes cuenta?
      <a routerLink="/login">Inicia sesión</a>
    </p>
  </div>
</section>
